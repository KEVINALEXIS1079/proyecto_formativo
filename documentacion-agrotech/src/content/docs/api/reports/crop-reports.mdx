---
title: Reportes Avanzados de Cultivos
description: An√°lisis detallado y exportaci√≥n de datos de cultivos
---

import { Tabs, TabItem, Code } from '@astrojs/starlight/components';

## GET /reports/crops/:id/summary

Obtiene un resumen completo del rendimiento de un cultivo espec√≠fico.

### Respuesta

```typescript
interface CropSummary {
  cultivo: {
    id: number;
    nombreCultivo: string;
    tipoCultivo: string;
    lote?: {
      nombre: string;
    };
  };
  resumen: {
    totalActividades: number;
    costoTotal: number;
    costoManoObra: number;
    costoInsumos: number;
    costoServicios: number;
    areaCultivada: number;
    rendimientoEsperado?: number;
    rendimientoActual?: number;
    fechaInicio: Date;
    fechaFin?: Date;
    estado: string;
  };
  estadisticas: {
    actividadesPorTipo: Array<{
      tipo: string;
      cantidad: number;
      costoTotal: number;
    }>;
    insumosMasUsados: Array<{
      nombre: string;
      cantidad: number;
      costoTotal: number;
    }>;
  };
}
```

## GET /reports/crops/:id/activities

Estad√≠sticas detalladas de actividades realizadas en el cultivo.

### Respuesta

```typescript
interface ActivityStats {
  tipoActividad: string;
  descripcion: string;
  cantidad: number;
  costoTotal: number;
  costoPromedio: number;
  ultimaEjecucion: Date;
  frecuenciaPromedio: number; // d√≠as entre ejecuciones
}
```

## GET /reports/crops/:id/labor

An√°lisis de mano de obra utilizada en el cultivo.

### Respuesta

```typescript
interface LaborStats {
  tipoLabor: string;
  descripcion: string;
  horasTotales: number;
  costoTotal: number;
  costoPorHora: number;
  trabajadoresUnicos: number;
  eficiencia: number; // horas por hect√°rea
}
```

## GET /reports/crops/:id/inputs

Estad√≠sticas de consumo de insumos por cultivo.

### Respuesta

```typescript
interface InputStats {
  insumo: {
    nombre: string;
    categoria: string;
    unidadMedida: string;
  };
  cantidadTotal: number;
  costoTotal: number;
  costoUnitarioPromedio: number;
  aplicaciones: number;
  ultimaAplicacion: Date;
}
```

## GET /reports/crops/:id/consistency

Valida la consistencia de los datos del cultivo.

### Respuesta

```typescript
interface ConsistencyValidation {
  esConsistente: boolean;
  errores: Array<{
    tipo: 'ERROR' | 'WARNING' | 'INFO';
    mensaje: string;
    campo?: string;
    valor?: any;
  }>;
  recomendaciones: string[];
}
```

## GET /reports/crops/:id/labor-by-period

An√°lisis de mano de obra por per√≠odos temporales.

### Par√°metros de Query

- `granularity`: `day` | `week` | `month` (default: `week`)

### Respuesta

```typescript
interface LaborByPeriod {
  periodo: string; // YYYY-MM-DD, YYYY-WW, YYYY-MM
  horasTotales: number;
  costoTotal: number;
  tiposLabor: Array<{
    tipo: string;
    horas: number;
    costo: number;
  }>;
}
```

## GET /reports/crops/:id/inputs-by-period

Consumo de insumos agrupado por per√≠odos.

### Par√°metros de Query

- `granularity`: `day` | `week` | `month` (default: `week`)

### Respuesta

```typescript
interface InputsByPeriod {
  periodo: string;
  costoTotal: number;
  insumos: Array<{
    nombre: string;
    cantidad: number;
    costo: number;
    aplicaciones: number;
  }>;
}
```

## GET /reports/crops/:id/detailed-activities

Lista detallada de todas las actividades con costos desglosados.

### Par√°metros de Query

- `from`: Fecha inicio (YYYY-MM-DD)
- `to`: Fecha fin (YYYY-MM-DD)

### Respuesta

```typescript
interface DetailedActivity {
  id: number;
  fecha: Date;
  tipoActividad: string;
  descripcion: string;
  costoTotal: number;
  costoManoObra: number;
  costoInsumos: number;
  costoServicios: number;
  areaAplicada: number;
  rendimiento?: number;
  observaciones?: string;
  insumosUtilizados: Array<{
    insumo: string;
    cantidad: number;
    costo: number;
  }>;
  manoObra: Array<{
    tipo: string;
    horas: number;
    costo: number;
  }>;
}
```

## GET /reports/crops/:id/top-inputs

Ranking de insumos m√°s utilizados/costosos.

### Par√°metros de Query

- `limit`: N√∫mero de resultados (default: 10)
- `sortBy`: `costo` | `cantidad` (default: `costo`)

### Respuesta

```typescript
interface TopInput {
  posicion: number;
  insumo: {
    nombre: string;
    categoria: string;
  };
  cantidadTotal: number;
  costoTotal: number;
  aplicaciones: number;
  costoPromedio: number;
}
```

## GET /reports/crops/:id/export

Exporta todos los datos del cultivo a Excel.

### Respuesta

Archivo Excel con m√∫ltiples hojas:
- **Resumen**: Estad√≠sticas generales
- **Actividades**: Lista completa de actividades
- **Mano de Obra**: Detalle de labor
- **Insumos**: Consumo de insumos
- **Detalle Actividades**: Actividades con desglose completo

## GET /reports/crops/export

Exporta reportes consolidados de m√∫ltiples cultivos.

### Par√°metros de Query

- `cultivoId`: ID espec√≠fico de cultivo
- `fechaInicio`: Fecha inicio (YYYY-MM-DD)
- `fechaFin`: Fecha fin (YYYY-MM-DD)
- `format`: `csv` | `xlsx` (default: `xlsx`)

### Filtros Disponibles

```bash
# Exportar cultivo espec√≠fico
GET /reports/crops/export?cultivoId=1

# Exportar cultivos en un per√≠odo
GET /reports/crops/export?fechaInicio=2025-01-01&fechaFin=2025-12-31

# Exportar en formato CSV
GET /reports/crops/export?format=csv
```

## Ejemplos de Uso

### An√°lisis de Eficiencia

```javascript
// Obtener resumen y actividades para an√°lisis
const [summary, activities] = await Promise.all([
  fetch(`/reports/crops/1/summary`),
  fetch(`/reports/crops/1/activities`)
]);

const eficiencia = summary.resumen.costoTotal / summary.resumen.areaCultivada;
console.log(`Costo por hect√°rea: $${eficiencia.toFixed(2)}`);
```

### Seguimiento de Costos por Per√≠odo

```javascript
// An√°lisis mensual de costos
const laborByMonth = await fetch(`/reports/crops/1/labor-by-period?granularity=month`)
  .then(r => r.json());

const costoMensual = laborByMonth.reduce((acc, mes) => {
  acc[mes.periodo] = mes.costoTotal;
  return acc;
}, {});
```

### Optimizaci√≥n de Insumos

```javascript
// Identificar insumos m√°s costosos
const topInputs = await fetch(`/reports/crops/1/top-inputs?limit=5&sortBy=costo`)
  .then(r => r.json());

const insumoMasCostoso = topInputs[0];
console.log(`Mayor costo: ${insumoMasCostoso.insumo.nombre} - $${insumoMasCostoso.costoTotal}`);
```

## Validaciones y Consistencia

### Reglas de Validaci√≥n

- **Fechas coherentes**: Fecha fin > fecha inicio
- **√Åreas positivas**: Todas las √°reas deben ser > 0
- **Costos v√°lidos**: No se permiten costos negativos
- **Unidades consistentes**: Verificaci√≥n de unidades de medida

### Tipos de Errores

```typescript
enum ValidationErrorType {
  MISSING_DATA = 'MISSING_DATA',
  INVALID_DATE = 'INVALID_DATE',
  NEGATIVE_VALUE = 'NEGATIVE_VALUE',
  INCONSISTENT_UNITS = 'INCONSISTENT_UNITS',
  DUPLICATE_ENTRY = 'DUPLICATE_ENTRY'
}
```

## M√©tricas Calculadas

### Eficiencia de Producci√≥n
```
Eficiencia = Rendimiento Actual / Rendimiento Esperado
```

### Costo por Unidad
```
Costo Unitario = Costo Total / √Årea Cultivada
```

### ROI (Retorno de Inversi√≥n)
```
ROI = (Ingresos - Costos) / Costos * 100
```

## Exportaci√≥n Avanzada

### Formatos Soportados

- **Excel (.xlsx)**: M√∫ltiples hojas, formato nativo
- **CSV (.csv)**: Datos planos, compatible con an√°lisis

### Estructura del Excel

```
üìä Cultivo {ID} - {Nombre}
‚îú‚îÄ‚îÄ üìã Resumen General
‚îú‚îÄ‚îÄ üìù Lista de Actividades
‚îú‚îÄ‚îÄ üë∑ Detalle de Mano de Obra
‚îú‚îÄ‚îÄ üß™ Consumo de Insumos
‚îî‚îÄ‚îÄ üìà An√°lisis Detallado
```

## C√≥digos de Error

| C√≥digo | Descripci√≥n |
|--------|-------------|
| `400` | Par√°metros inv√°lidos o cultivo no encontrado |
| `403` | Sin permisos para acceder a reportes |
| `404` | Cultivo no existe |
| `500` | Error interno en generaci√≥n de reporte |

## Optimizaciones de Rendimiento

### Cach√© Inteligente
- Resultados cacheados por 1 hora
- Invalidaci√≥n autom√°tica al actualizar datos

### Paginaci√≥n Autom√°tica
- Grandes datasets divididos autom√°ticamente
- Navegaci√≥n eficiente en reportes extensos

### Compresi√≥n de Datos
- Archivos Excel optimizados
- Reducci√≥n de tama√±o sin p√©rdida de informaci√≥n

:::note[Reportes en Tiempo Real]
Los reportes se actualizan autom√°ticamente cuando se registran nuevas actividades o insumos.
:::

:::tip[An√°lisis Comparativo]
Usa m√∫ltiples cultivos para identificar patrones y optimizar procesos agr√≠colas.
:::

:::warning[Validaci√≥n de Datos]
Siempre verifica la consistencia antes de tomar decisiones basadas en los reportes.
:::